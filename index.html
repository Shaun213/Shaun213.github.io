<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Zombie Strike</title>
<style>
body { margin:0; overflow:hidden; background:#000; font-family:Arial; color:white;}
#hud { position:absolute; top:15px; left:15px; z-index:10;}
#crosshair {
position:absolute; top:50%; left:50%;
width:12px; height:12px;
margin-left:-6px; margin-top:-6px;
border:2px solid white;
border-radius:50%;
z-index:10;
}
</style>
</head>
<body>

<div id="hud"></div>
<div id="crosshair"></div>

<script type="module">

import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158/build/three.module.js';
import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.158/examples/jsm/controls/PointerLockControls.js';

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x101522);
scene.fog = new THREE.Fog(0x000000, 20, 150);

let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0,2,0);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* CONTROLS (FIXED) */
let controls = new PointerLockControls(camera, document.body);
document.body.addEventListener("click", () => controls.lock());
scene.add(controls.getObject());

/* LIGHTING */
scene.add(new THREE.HemisphereLight(0x88aaff,0x080820,0.6));

let dir = new THREE.DirectionalLight(0xffffff,1);
dir.position.set(20,40,20);
dir.castShadow=true;
scene.add(dir);

/* GROUND */
let ground = new THREE.Mesh(
new THREE.PlaneGeometry(500,500),
new THREE.MeshStandardMaterial({color:0x222222})
);
ground.rotation.x=-Math.PI/2;
ground.receiveShadow=true;
scene.add(ground);

/* BUILDINGS */
for(let i=0;i<40;i++){
let h=Math.random()*20+10;
let b=new THREE.Mesh(
new THREE.BoxGeometry(10,h,10),
new THREE.MeshStandardMaterial({color:0x333333})
);
b.position.set((Math.random()-0.5)*300,h/2,(Math.random()-0.5)*300);
b.castShadow=true;
scene.add(b);
}

/* SIMPLE ZOMBIE */
let zombies=[];
function spawnZombie(){
let z=new THREE.Mesh(
new THREE.BoxGeometry(2,4,2),
new THREE.MeshStandardMaterial({color:0x006600})
);
z.position.set((Math.random()-0.5)*200,2,(Math.random()-0.5)*200);
z.health=100;
scene.add(z);
zombies.push(z);
}
setInterval(spawnZombie,2000);

/* SHOOT */
document.addEventListener("mousedown",()=>{
let ray=new THREE.Raycaster(
camera.position,
new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion)
);
let hits=ray.intersectObjects(zombies);
if(hits.length>0){
let z=hits[0].object;
z.health-=50;
if(z.health<=0){
scene.remove(z);
zombies.splice(zombies.indexOf(z),1);
}
}
});

/* MOVEMENT */
let move={};
document.addEventListener("keydown",e=>move[e.code]=true);
document.addEventListener("keyup",e=>move[e.code]=false);

/* LOOP */
function animate(){
requestAnimationFrame(animate);

if(controls.isLocked){
let speed=0.15;
if(move["KeyW"]) controls.moveForward(speed);
if(move["KeyS"]) controls.moveForward(-speed);
if(move["KeyA"]) controls.moveRight(-speed);
if(move["KeyD"]) controls.moveRight(speed);
}

zombies.forEach(z=>{
let dir=camera.position.clone().sub(z.position).normalize();
z.position.add(dir.multiplyScalar(0.02));
});

renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
